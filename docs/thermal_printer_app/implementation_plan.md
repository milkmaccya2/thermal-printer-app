# 実装計画 - Web Share Target PWA

## 目標
**Web Share Target API** をサポートし、アプリケーションをPWA化することで、スマートフォンの「共有」メニューから直接印刷できるようにする。

## ユーザーレビュー必須事項
> [!IMPORTANT]
> **iOSの制限**: Web Share Target API（PWAへのファイル共有）は、iOS/Safariでのサポートが限定的です。Android/Chromeでは確実に動作します。iOSの場合、ユーザーは引き続き標準の「アップロード」ボタンを使用するか、iOSショートカットを使用した回避策が必要になる可能性があります。

## 変更案

### 1. PWAマニフェスト (`public/manifest.json`)
アプリをインストール可能（ホーム画面に追加）にするためのマニフェストファイルを作成する。
- **名前**: Thermal Printer
- **表示**: Standalone
- **共有ターゲット**: `/share-target` エンドポイントを登録し、`POST` (multipart/form-data) 経由で `image/*` を受け入れる。

### 2. Service Worker (`public/sw.js` & 登録)
最小限のService Workerを追加する。
- PWAインストール基準（fetchハンドラ）を満たすために必要。
- 現時点では単純なパススルーでよい。

### 3. 共有ターゲットハンドラ (`src/pages/share-target.astro`)
共有シートからのPOSTリクエストを処理するための新しいページ（またはAPIルート）を作成する。
- **アクション**: カスタマイズされた `multipart/form-data` を受け入れる。
- **ロジック**:
    - ファイルを抽出する。
    - （オプション）画像がプリロードされた状態でメインページにリダイレクトする、または
    - 即座に処理して印刷する（強引すぎる可能性がある）。
    - **提案**: アップロードされたファイルが事前に入力された `ImagePrinter` コンポーネントをレンダリングする、純粋なPOSTハンドラページを使用する。

### 4. Astro設定 / レイアウト
`src/pages/index.astro`（またはグローバルレイアウト）を更新し、`manifest.json` をリンクして `sw.js` を登録する。

## 検証計画
### 自動テスト
- PWA固有のものはなし。

### 手動検証
1. **Android**:
    - Chromeでアプリを開く -> "アプリをインストール"。
    - 写真へ移動 -> 共有 -> "Thermal Printer"を選択。
    - アプリが開き、画像の印刷準備ができていることを確認する。
2. **iOS**:
    - Safariで開く -> "ホーム画面に追加"。
    - 画像を共有してみる（OSバージョンでサポートされている場合）、またはアプリがスタンドアロンとして開くことを確認する。
